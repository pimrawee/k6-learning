## Thresholds 


# Thresholds คืออะไร?
- **Thresholds** คือเกณฑ์ที่กำหนดขึ้นในสคริปต์เพื่อประเมินประสิทธิภาพของระบบ
- ใช้ตรวจสอบว่าแอปพลิเคชันทำงานได้ตามเป้าหมายที่ตั้งไว้ เช่น:
  - เวลาตอบสนอง (response time)
  - อัตราความสำเร็จของคำขอ (success rate)
- หากเกณฑ์ของ Threshold ถูกละเมิด การทดสอบจะ **ล้มเหลวทันที**
- แตกต่างจาก **Checks** ซึ่งเป็นการตรวจสอบเงื่อนไขและบันทึกผลว่า "ผ่าน/ไม่ผ่าน" แต่จะไม่ทำให้การทดสอบหยุด


# วิธีการกำหนด Thresholds ใน k6
- **ไม่ต้อง Import Library**: ไม่จำเป็นต้อง import library ใดๆ สำหรับการใช้งาน thresholds เพียงแค่กำหนดในอ็อบเจกต์ `options` ในสคริปต์
- **โครงสร้างของ `options`**: Thresholds จะถูกกำหนดเป็นอาเรย์ภายในอ็อบเจกต์ `options` ซึ่งสามารถเพิ่มเกณฑ์ได้หลายรายการ
- **ส่วนประกอบของ Threshold**: 
    - `metric`: ชื่อของ metric ที่ต้องการติดตาม เช่น `http_req_duration` (เวลาตอบสนองของ HTTP request) หรือ `http_req_blocked` (เวลาที่ request ถูกบล็อก)
    - `expression`: เกณฑ์ที่ต้องการประเมิน เช่น `max < 200` หรือ `p(95) < 1000`
    - `abortOnFail (Optional)`: หากตั้งค่า flag นี้เป็น `true` k6 จะหยุดการทำงานทันทีหากมีการละเมิดเกณฑ์ที่กำหนดไว้


# ประเภทของ metric ที่ใช้ใน Thresholds
1. **Counter (ตัวนับ)**
    - หน้าที่: ใช้สำหรับสะสมค่ารวมทั้งหมด หรือผลรวมของค่าต่างๆ
    - การทำงาน: บวกค่าทุกครั้งที่เกิดขึ้น และแสดงผลรวมสุดท้าย
    - ตัวอย่าง: หากมีการเพิ่มค่า 1, 2, 3 ในแต่ละ iteration และมีการทำซ้ำ 5 iterations → ค่ารวม = (1+2+3) * 5 = 30
2. **Gauge (เกจ)**
    - หน้าที่: ใช้แสดงค่าสุดท้าย (last value)
    - การทำงาน: แสดงค่าสุดท้าย รวมถึงค่าต่ำสุด (minimum) และสูงสุด (maximum) ของชุดข้อมูลนั้นๆ
    - ตัวอย่าง: ค่าเข้า [1, 5, 10] → Last = 10, Min = 1, Max = 10
3. **Rate (อัตรา)**
    - หน้าที่: แสดงเปอร์เซ็นต์ของค่าที่ “ผ่าน” หรือ “ไม่ผ่าน”
    - การทำงาน: คำนวณอัตราความสำเร็จ (true/false)
    - ตัวอย่าง: ค่าทั้งหมด 4 รายการ, 2 เป็น `true`, 2 เป็น `false` → 50%
4. **Trend (แนวโน้ม)**
    - หน้าที่: เป็น metric ที่ช่วยคำนวณค่าสถิติต่างๆ จากค่าที่เก็บ
    - การทำงาน: สามารถแสดงค่าสถิติ เช่น ค่าเฉลี่ย (average), ค่าต่ำสุด (minimum), ค่าสูงสุด (maximum), ค่ามัธยฐาน (median) และเปอร์เซ็นไทล์ (percentile) ต่างๆ เช่น 90th percentile และ 95th percentile ของเวลาตอบสนองในหน่วยมิลลิวินาที
    - ความเหมาะสม: เหมาะสำหรับใช้วิเคราะห์ `เวลาตอบสนอง (response time)`